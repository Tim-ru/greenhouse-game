# Настройка Bitmap-стиля движения персонажа

## Обзор системы

Система состоит из нескольких компонентов, работающих вместе для создания bitmap-стиля движения:

1. **BeltMover** - основной компонент движения с ограничением по Y-координате
2. **YSorter** - автоматическая сортировка спрайтов по глубине
3. **WalkArea** - определение области ходьбы персонажа
4. **WalkAreaSetup** - утилита для автоматической настройки
5. **PlayerController** - модифицированный контроллер ввода

## Пошаговая настройка

### 1. Настройка камеры
```
Camera → Orthographic
Size: подстройте под размер экрана
```

### 2. Создание фона
- Создайте большой спрайт с перспективной сценой
- Установите **Order in Layer = 0**

### 3. Настройка персонажа

#### 3.1 Добавление компонентов
На персонаже должны быть:
- `Rigidbody2D` (Dynamic, gravityScale = 0)
- `CapsuleCollider2D`
- `BeltMover` (автоматически добавляется)
- `YSorter`
- `PlayerController` (модифицированный)

#### 3.2 Настройка BeltMover
```csharp
Speed: 4f (скорость движения)
Walk Y Range: 
  - X: -1.5f (нижняя граница)
  - Y: -0.2f (верхняя граница)
```

#### 3.3 Настройка YSorter
```csharp
Offset: 0 (базовое смещение)
Multiplier: 100 (точность сортировки)
```

### 4. Создание области ходьбы

#### 4.1 Создание WalkArea
1. Создайте пустой GameObject "WalkArea"
2. Добавьте компонент `WalkArea`
3. Добавьте `BoxCollider2D`
4. Настройте:
   - **Is Trigger = true**
   - **Size**: ширина всей сцены, высота = "глубина" прохода

#### 4.2 Автоматическая настройка
1. Добавьте `WalkAreaSetup` на персонажа
2. Перетащите WalkArea в поле Walk Area
3. Компонент автоматически синхронизирует границы

### 5. Настройка тени
1. Создайте дочерний объект "Shadow" под персонажем
2. Добавьте SpriteRenderer с спрайтом-блином
3. Установите **Order in Layer = (персонаж - 1)**

### 6. Коллизии окружения
- Добавляйте обычные `BoxCollider2D` на столы/стены
- Они автоматически ограничат движение в проходе

## Принцип работы

### Движение
- `PlayerController` получает ввод от Input System
- Передает данные в `BeltMover.SetInput()`
- `BeltMover` ограничивает Y-координату в заданных пределах
- X-координата остается свободной для движения

### Сортировка по глубине
- `YSorter` автоматически обновляет `sortingOrder` в `LateUpdate`
- Формула: `offset + (int)(-transform.position.y * multiplier)`
- Чем ниже объект на экране, тем выше его sortingOrder

### Область ходьбы
- `WalkArea` определяет границы области ходьбы
- `WalkAreaSetup` синхронизирует границы с `BeltMover`
- Визуализация в Scene View через Gizmos

## Настройка параметров

### BeltMover
- **Speed**: скорость движения персонажа
- **Walk Y Range**: границы области ходьбы по Y

### YSorter
- **Offset**: базовое смещение для сортировки
- **Multiplier**: точность сортировки (больше = точнее)

### WalkArea
- **Walk Width**: ширина области ходьбы
- **Walk Height**: высота области ходьбы
- **Is Trigger**: режим триггера коллайдера

## Отладка

### Визуализация
- `BeltMover`: показывает границы области ходьбы (зеленый)
- `WalkArea`: показывает область ходьбы (голубой)
- `WalkAreaSetup`: показывает связь между компонентами (пурпурный)

### Логи
- `WalkAreaSetup` выводит информацию о синхронизации границ
- `WalkArea` выводит сообщения при входе/выходе персонажа

## Расширение системы

### Параллакс
Для добавления параллакса:
1. Разбейте фон на 2-3 слоя
2. Создайте скрипт, который двигает слои медленнее игрока по X
3. Используйте `transform.position.x` для расчета смещения

### Дополнительные объекты
Для объектов в сцене:
1. Добавьте `YSorter` на все спрайты
2. Настройте `offset` для правильного порядка отображения
3. Используйте `multiplier` для точной настройки глубины
